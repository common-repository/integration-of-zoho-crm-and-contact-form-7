var S=Object.defineProperty;var D=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var O=(t,l,i)=>l in t?S(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i,h=(t,l)=>{for(var i in l||(l={}))j.call(l,i)&&O(t,i,l[i]);if(D)for(var i of D(l))L.call(l,i)&&O(t,i,l[i]);return t};import{_ as r,c as m,s as v}from"./bi-727-9.js";const J=(t,l,i,f,d,s,e,a,n,o)=>{let u=h({},i);if(l===0){if(a){const c=h({},n);c[t.target.name]="",o(h({},c))}u[t.target.name]=t.target.value}else u.relatedlists||(u.relatedlists=[]),u.relatedlists[l-1][t.target.name]=t.target.value;switch(t.target.name){case"module":u=E(l,d,u,f,s,e);break;case"layout":u=A(l,d,u);break}f(h({},u))},N=(t,l,i,f,d,s,e)=>{var a,n;t&&!((n=(a=f.default)==null?void 0:a.relatedlists)!=null&&n[f.module])&&refreshRelatedList(i,f,d,s,e),l(t)},E=(t,l,i,f,d,s)=>{var n,o;let e=h({},i);const a=t===0?e.module:e.relatedlists[t-1].module;if(e.relatedlists[t-1]||(e.relatedlists[t-1]={}),t===0?(e.layout="",e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists=[]):(e.relatedlists[t-1].layout="",e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}]),!((n=e.default.layouts)!=null&&n[a]))Z(t,l,e,f,d,s);else{const u=Object.keys((o=e.default.layouts)==null?void 0:o[a]);u.length===1&&(t===0?[e.layout]=u:[e.relatedlists[t-1].layout]=u,e=A(t,l,e))}return e},A=(t,l,i,f,d,s)=>{var o,u,c,y,p,z,_,g,k,R,w,I,q,U,M,$;const e=h({},i),a=t===0?e.module:e.relatedlists[t-1].module,n=t===0?e.layout:e.relatedlists[t-1].layout;return t===0?(e.actions={},e.field_map=(y=(c=(u=(o=e==null?void 0:e.default)==null?void 0:o.layouts)==null?void 0:u[a])==null?void 0:c[n])!=null&&y.required?F(t,e):[{formField:"",zohoFormField:""}],e.upload_field_map=(g=(_=(z=(p=e==null?void 0:e.default)==null?void 0:p.layouts)==null?void 0:z[a])==null?void 0:_[n])!=null&&g.requiredFileUploadFields&&Object.keys(e.default.layouts[a][n].requiredFileUploadFields).length>0?F(t,e,!0):[{formField:"",zohoFormField:""}]):(e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=(I=(w=(R=(k=e==null?void 0:e.default)==null?void 0:k.layouts)==null?void 0:R[a])==null?void 0:w[n])!=null&&I.required?F(t,e):[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=($=(M=(U=(q=e==null?void 0:e.default)==null?void 0:q.layouts)==null?void 0:U[a])==null?void 0:M[n])!=null&&$.requiredFileUploadFields&&Object.keys(e.default.layouts[a][n].requiredFileUploadFields).length>0?F(t,e,!0):[{formField:"",zohoFormField:""}]),e},W=(t,l,i,f,d)=>{f(!0);const s={formID:t,id:l.id,dataCenter:l.dataCenter,clientId:l.clientId,clientSecret:l.clientSecret,tokenDetails:l.tokenDetails};m(s,"zcrm_refresh_modules").then(e=>{if(e&&e.success){const a=h({},l);a.default||(a.default={}),e.data.modules&&(a.default.modules=e.data.modules),e.data.tokenDetails&&(a.tokenDetails=e.data.tokenDetails),i(h({},a)),d({show:!0,msg:r("Modules refreshed","bitcf7zc")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:v(r("Modules refresh failed Cause: %s. please try again","bitcf7zc"),e.data.data||e.data)}):d({show:!0,msg:r("Modules refresh failed. please try again","bitcf7zc")});f(!1)}).catch(()=>f(!1))},Z=(t,l,i,f,d,s)=>{const e=h({},i),a=t===0?e.module:e.relatedlists[t-1].module;if(!a)return;d(!0);const n={formID:l,module:a,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};m(n,"zcrm_refresh_layouts").then(o=>{var u,c;if(o&&o.success){if(o.data.layouts){e.default.layouts||(e.default.layouts={}),e.default.layouts[a]=o.data.layouts;const y=[...Object.keys(o.data.layouts)];y.length===1&&(t===0?([e.layout]=y,e.field_map=F(t,e),Object.keys(o.data.layouts[y].fileUploadFields).length>0&&(e.upload_field_map=F(t,e,!0))):([e.relatedlists[t-1].layout]=y,e.relatedlists[t-1].field_map=F(t,e),Object.keys(o.data.layouts[y].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=F(t,e,!0))),(u=e.default.tags)!=null&&u[a]||refreshTags(t,l,e,f,d,s))}o.data.tokenDetails&&(e.tokenDetails=o.data.tokenDetails),f(h({},e)),s({show:!0,msg:r("Layouts refreshed","bitcf7zc")})}else(c=o==null?void 0:o.data)!=null&&c.data||!o.success&&typeof o.data=="string"?s({show:!0,msg:v(r("Layouts refresh failed Cause: %s. please try again","bitcf7zc"),o.data.data||o.data)}):s({show:!0,msg:r("Layouts refresh failed. please try again","bitcf7zc")});d(!1)}).catch(()=>d(!1))},F=(t,l,i)=>{const f=t===0?l.module:l.relatedlists[t-1].module,d=t===0?l.layout:l.relatedlists[t-1].layout;return i?l.default.layouts[f][d].requiredFileUploadFields.length>0?l.default.layouts[f][d].requiredFileUploadFields.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]:l.default.layouts[f][d].required.length>0?l.default.layouts[f][d].required.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]},B=t=>{const l=t!=null&&t.field_map?t.field_map.filter(s=>{var e,a,n,o;return!s.formField&&s.zohoFormField&&((o=(n=(a=(e=t==null?void 0:t.default)==null?void 0:e.layouts)==null?void 0:a[t.module])==null?void 0:n[t.layout])==null?void 0:o.required.indexOf(s.zohoFormField))!==-1}):[],i=t!=null&&t.upload_field_map?t.upload_field_map.filter(s=>!s.formField&&s.zohoFormField&&t.default.layouts[t.module][t.layout].requiredFileUploadFields.indexOf(s.zohoFormField)!==-1):[],f=t.relatedlists.map(s=>s.field_map.filter(e=>!e.formField&&e.zohoFormField)),d=t.relatedlists.map(s=>s.upload_field_map.filter(e=>!e.formField&&e.zohoFormField));return!(l.length>0||i.length>0||f.some(s=>s.length)||d.some(s=>s.length))},G=(t,l,i,f,d,s)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){i({dataCenter:t.dataCenter?"":r("Data center cann't be empty","bitcf7zc"),clientId:t.clientId?"":r("Client ID cann't be empty","bitcf7zc"),clientSecret:t.clientSecret?"":r("Secret key cann't be empty","bitcf7zc")});return}d(!0);const e="ZohoCRM.modules.ALL,ZohoCRM.settings.ALL,ZohoCRM.users.Read,zohocrm.files.CREATE",a=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${e}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&redirect_uri=${bitcf7==null?void 0:bitcf7.redirect}&state=${encodeURIComponent(window.location.href)}/redirect`,n=window.open(a,"zohoCRM","width=400,height=609,toolbar=off"),o=setInterval(()=>{if(n.closed){clearInterval(o);let u={},c=!1;const y=localStorage.getItem("__bitforms_zohoCRM");if(y&&(c=!0,u=JSON.parse(y),localStorage.removeItem("__bitforms_zohoCRM")),!u.code||u.error||!u||!c){const p=u.error?`Cause: ${u.error}`:"";s({show:!0,msg:`${r("Authorization failed","bitcf7zc")} ${p}. ${r("please try again","bitcf7zc")}`}),d(!1)}else{const p=h({},t);p.accountServer=u["accounts-server"],x(u,p,l,f,d,s)}}},500)},x=(t,l,i,f,d,s)=>{const e=h({},t);e.dataCenter=l.dataCenter,e.clientId=l.clientId,e.clientSecret=l.clientSecret,e.redirectURI=bitcf7==null?void 0:bitcf7.redirect,m(e,"zcrm_generate_token").then(a=>a).then(a=>{if(a&&a.success){const n=h({},l);n.tokenDetails=a.data,i(n),f(!0),s({show:!0,msg:r("Authorized Successfully","bitcf7zc")})}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?s({show:!0,msg:`${r("Authorization failed Cause:","bitcf7zc")}${a.data.data||a.data}. ${r("please try again","bitcf7zc")}`}):s({show:!0,msg:r("Authorization failed. please try again","bitcf7zc")});d(!1)})};export{N as a,W as b,B as c,G as d,J as h,Z as r};
